# Web3.js EIP4337 Plugin

This plugin is developed and maintained by [Blocto](https://blocto.io/) .

This is a [web3.js](https://github.com/web3/web3.js) `4.x` plugin for Account Abstraction functionality.

## Run the tests

1. Clone the repo
2. Run `yarn` to install dependencies
   - If you receive the following warning, please remove the file `package-lock.json` and make sure to run `yarn` to install dependencies instead of `npm i`:

```console
warning package-lock.json found. Your project contains lock files generated by tools other than Yarn. It is advised not to mix package managers in order to avoid resolution inconsistencies caused by unsynchronized lock files. To clear this warning, remove package-lock.json.
```

3. Run the tests:
   - `yarn test:unit`: Runs the mocked tests that do not make a network request using the [Jest](https://jestjs.io/) framework
   - End-to-end tests: Runs Webpack bundled tests that make a network request to the RPC provider `https://rpc.ankr.com/eth` and returns an actual response from `MainnetPriceFeeds.LinkEth` smart contract using the [Cypress](https://www.cypress.io/) framework
     - `yarn test:e2e:chrome`: Runs the tests using Chrome
     - `yarn test:e2e:electron`: Runs the tests using Electron
     - `yarn test:e2e:firefox`: Runs the tests using Firefox
   - Black box tests: Uses a published version of the plugin from [Verdaccio](https://verdaccio.org/) to run tests that make a network request to the RPC provider `https://rpc.ankr.com/eth` and returns an actual response from `MainnetPriceFeeds.LinkEth` smart contract using the [Jest](https://jestjs.io/) framework
     - NOTE The black box tests are setup to run within Github actions environment, but can be ran locally. The [black_box_test_helpers.sh](https://github.com/ChainSafe/web3.js-plugin-chainlink/blob/master/scripts/black_box_test_helpers.sh) script can be used to:
       - `start`: Start Verdaccio using a Docker container
       - `stop`: Kill the Docker container
       - `startBackgroundAndPublish`: Starts a headless Docker container and publishes the plugin package
       - `runTests`: `cd`s into the `test/black_box` directory, installs the black box package dependencies, and runs `yarn test` which will use Jest to run the tests
     - In addition to the `black_box_test_helpers.sh` script, the black box tests can be ran using the following `package.json` scripts:
       1. `yarn pre-black-box`: Calls `startBackgroundAndPublish` from the `black_box_test_helpers.sh` script
       2. `yarn test:black-box`: Calls `yarn pre-black-box` and `runTests` from the from the `black_box_test_helpers.sh` script
       3. `yarn post-black-box`: Calls `stop` from the `black_box_test_helpers.sh` script

## License

[MIT](https://choosealicense.com/licenses/mit/)
